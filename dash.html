<html>
  <head>
    <!-- Page Setup-->
    <title>Drizzle</title>
    <link rel="shortcut icon" type="image/png" href="icon.png">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Axios -->
    <script src='https://unpkg.com/axios@0.21.1/dist/axios.min.js'></script>

  </head>

  <body>
    <nav>
      <div class="nav-wrapper blue darken-2">
        <a href="#" class="brand-logo right" style="margin-right:10px; margin-bottom:15px;">Drizzle<img src="icon.png" style="margin-bottom:-20px;"></a>
        <ul id="nav-mobile" class="left hide-on-med-and-down">
          <li><a href="index.html">Home</a></li>
          <li><a href="help.html">Help</a></li>
          <li><a href="dash.html">Dash</a></li>
        </ul>
      </div>
    </nav>

    <div class="row"> <!-- Row 1 -->
      <div class="col s12 m6">
        <div class="card white darken-1">
          <div class="card-content black-text">
            <span class="card-title" id='geo'></span>
            <div class="row">
              <div class="col s6">
                <div id='date'></div>
              </div>
              <div class="col s6">
                <div id='time'></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col s12 m6">
        <div class="card white darken-1">
          <div class="card-content black-text">
            <span class="card-title">The weather today:</span>
            <div id='weather'>
              <div class="progress">
                <div class="indeterminate"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> <!-- Row 1 End -->

    <div class="row"> <!-- Row 3 -->
      <div class="col s12">
        <div class="card white darken-1">
          <div class="card-content black-text">
            <span class="card-title">Weather:</span>
            <p>Heatstroke weather, you won't like it.</p>
          </div>
        </div>
      </div>
    </div> <!-- Row 3 End -->

  </body>

  <script>

    axios.get('https://ipapi.co/json/')
         .then(ipdata => {
           var response = ipdata.data
           var lat = response.latitude
           var long = response.longitude
           geoData(response.city + ', ' + response.region, response.country_name);
           var wstr = 'https://www.7timer.info/bin/civillight.php?lon=' + long + '&lat=' + lat + '&unit=metric&output=json'
           console.log(wstr)
           weatherData(wstr)
         })

    function geoData(param, country) {
      var geoPlace = document.getElementById('geo')
      geoPlace.innerHTML = 'Your location: ' + param + ' (' + country +')';
    }

    function weatherData(wstr) {
      axios.get(wstr)
           .then(wdata => {
             var wPlace = document.getElementById('weather')
             let response = wdata.data
             let wToday = response.dataseries[0]
             var myHTML = "Today's temperature can be from " + wToday.temp2m.min + " to " + wToday.temp2m.max
             wPlace.innerHTML = myHTML
           })
    }

  </script>
</html>
